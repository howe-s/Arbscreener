{% extends "base.html" %}

{% block title %}Home - Dexscreener{% endblock %}

{% block content %}
    <div class="card-container">
        <div class="card" id="summary-div"></div>
        {% for TokenPair in search %}
        <div class="card" data-token-pair="{{ TokenPair }}">
            <div class="card-content">
                <div><span class="label">Chain ID:</span> <span class="value" id="chain_id">{{ TokenPair.chain_id }}</span></div>
                <div><span class="label">Liquidity (USD):</span> <span class="value" id="liquidity">${{ TokenPair.liquidity.usd | round(0) }}</span></div>
                <div><span class="label">Price (Native):</span> <span class="value" id="price_native">{{ TokenPair.price_native | round(2) }}</span></div>
                <div><span class="label">Price (USD):</span> <span class="value" id="price_usd">${{ TokenPair.price_usd | round(2) }}</span></div>
                <div><span class="label">Volume (24h):</span> <span class="value" id="volume_24h">${{ TokenPair.volume.h24 | round(2) }}</span></div>
                <div><span class="label" >Pair Address:</span> <span class="value" id="pair_address">{{ TokenPair.pair_address }}</span></div>
            </div>
            <div class="card-title">{{ TokenPair.quote_token.symbol }} / {{ TokenPair.base_token.symbol }}</div>
        </div>
        {% endfor %}
    </div>
<script>
document.addEventListener('DOMContentLoaded', () => {
    const cards = document.querySelectorAll('.card');
    const summaryDiv = document.getElementById('summary-div');
    let isDragging = false;
    let offsetX = 0;
    let offsetY = 0;

    cards.forEach(card => {
        card.addEventListener('click', () => {
            const tokenPairAddress = card.querySelector('#pair_address').textContent;
            const cardTitle = card.querySelector('.card-title').textContent;
            const cardVolume = card.querySelector('#volume_24h').textContent;
            const cardPriceNative = card.querySelector('#price_native').textContent;
            const cardPriceUSD = card.querySelector('#price_usd').textContent;
            const cardLiquidity = card.querySelector('#liquidity').textContent;
            console.log(tokenPairAddress)
            // summaryDiv.innerHTML = `
            //     <p>Token Pair Address: ${tokenPairAddress}</p>
            //     <p>Title: ${cardTitle}</p>
            //     <p>Volume: ${cardVolume}</p>
            //     <p>Liquidity: ${cardLiquidity}</p>
            //     <p>Price (Native): ${cardPriceNative}</p>
            //     <p>Price (USD): ${cardPriceUSD}</p>
            //     <img id="chart-summary"></img>
            // `;

            // Call the function to send data to Flask with TokenPairAddress
            sendTokenPairAddressToFlask(tokenPairAddress);

            summaryDiv.style.display = 'inline-block';
            summaryDiv.style.top = '50%';
            summaryDiv.style.left = '50%';
            summaryDiv.style.transform = 'translate(-50%, 0)';
        });
    });

    summaryDiv.addEventListener('mousedown', (event) => {
        isDragging = true;
        offsetX = event.clientX - summaryDiv.offsetLeft;
        offsetY = event.clientY - summaryDiv.offsetTop;
        summaryDiv.style.cursor = 'grabbing';
    });

    document.addEventListener('mousemove', (event) => {
        if (isDragging) {
            summaryDiv.style.left = `${event.clientX - offsetX}px`;
            summaryDiv.style.top = `${event.clientY - offsetY}px`;
        }
    });

    document.addEventListener('mouseup', () => {
        isDragging = false;
        summaryDiv.style.cursor = 'move';
    });

    function sendTokenPairAddressToFlask(tokenPairAddress) {
        fetch('/process-data', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ tokenPairAddress: tokenPairAddress }),
        })
        .then(response => response.json())
        .then(data => {
            console.log('Success this one:', data);
            const jsonString = JSON.stringify(data);
            summaryDiv.innerHTML = `
                <p>Token Pair Address: ${tokenPairAddress}</p>
                <p>Trades: ${jsonString}</p>
            `;
            const table = document.getElementById('summary-div');
            for (const [timeFrame, transactionDetails] of Object.entries(data)) {
            // Create a new table row
            const row = document.createElement('tr');
            
            // Create a cell for the time frame and add it to the row
            const timeFrameCell = document.createElement('td');
            timeFrameCell.textContent = timeFrame;
            row.appendChild(timeFrameCell);

            // Create a cell for the transaction details and add it to the row
            const transactionDetailsCell = document.createElement('td');
            transactionDetailsCell.textContent = transactionDetails;
            row.appendChild(transactionDetailsCell);

            // Add the row to the table
            table.appendChild(row);
        }
            console.log('test')
        })
        .catch((error) => {
            console.error('Error:', error);
        });
    }
});




</script>
<style>
    .card-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        margin: 0 auto;
        padding: 0 10px;
        width: 100%;
        box-sizing: border-box;
    }
    .card {
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 10px;
        margin: 20px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        background-color: #f9f9f9;
        width: 425px;
        display: flex;
        float: left;
        position: relative;
        cursor: pointer;
    }
    .card-title {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 10px;
        align-self: flex-end;
        position: absolute;
        top: 10px;
        right: 10px;
    }
    .card-content .label {
        font-weight: bold;
        display: inline-block;
        width: 150px;
    }
    .card-content .value {
        display: inline-block;
    }
    .summary-table table {
        width: 100%;
        border-collapse: collapse;
    }
    .summary-table th, .summary-table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
    }
    .summary-table th {
        background-color: #f2f2f2;
    }

    #summary-div {
        display: none;
        position: absolute;
        top: 0;
        left: 0;
        width: 75%;
        height: 200px;
        background-color: white;
        border: 1px solid #ccc;
        padding: 20px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        z-index: 1000;
    }
</style>
{% endblock %}