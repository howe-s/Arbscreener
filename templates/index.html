{% extends "base.html" %}

{% block title %}Home - Dexscreener{% endblock %}

{% block content %}
    <div class="card-container">
        <div class="card" id="summary-div"></div>
        {% for TokenPair in search %}
        <div class="card" data-token-pair="{{ TokenPair }}">
            <div class="card-content">
                <div><span class="label">Chain ID:</span> <span class="value" id="chain_id">{{ TokenPair.chain_id }}</span></div>
                <div><span class="label">Liquidity (USD):</span> <span class="value" id="liquidity">${{ TokenPair.liquidity.usd | round(0) }}</span></div>
                <div><span class="label">Price (Native):</span> <span class="value" id="price_native">{{ TokenPair.price_native | round(2) }}</span></div>
                <div><span class="label">Price (USD):</span> <span class="value" id="price_usd">${{ TokenPair.price_usd | round(2) }}</span></div>
                <div><span class="label">Volume (24h):</span> <span class="value" id="volume_24h">${{ TokenPair.volume.h24 | round(2) }}</span></div>
                <div><span class="label" >Pair Address:</span> <span class="value" id="pair_address">{{ TokenPair.pair_address }}</span></div>
            </div>
            <div class="card-title">{{ TokenPair.quote_token.symbol }} / {{ TokenPair.base_token.symbol }}</div>
        </div>
        {% endfor %}
    </div>
<script>
document.addEventListener('DOMContentLoaded', () => {
    const cards = document.querySelectorAll('.card');
    const summaryDiv = document.getElementById('summary-div');

    cards.forEach(card => {
        card.addEventListener('click', () => {
            // Retrieve the token pair address
            const tokenPair = card.dataset.tokenPair;
            
            // Retrieve the card-title
            const tokenPairAddress = card.querySelector('#pair_address').textContent
            const cardTitle = card.querySelector('.card-title').textContent;
            const cardVolume = card.querySelector('#volume_24h').textContent;
            const cardPriceNative = card.querySelector('#price_native').textContent
            const cardPriceUSD = card.querySelector('#price_usd').textContent
            const cardLiquidity = card.querySelector('#liquidity').textContent
            console.log(cardVolume)

            // Update the summaryDiv with both tokenPairAddress and cardTitle
            summaryDiv.innerHTML = `
                <p>Token Pair Address: ${tokenPairAddress}</p>
                <p>Title: ${cardTitle}</p>
                <p>Volume: ${cardVolume}</p>
                <p>Liquidity: ${cardLiquidity}</p>
                <p>Price (Native): ${cardPriceNative}</p>
                <p>Price (USD): ${cardPriceUSD}</p>
                <img id="chart-summary"></img>
            `;

            summaryDiv.style.display = 'inline-block';
            summaryDiv.style.position = 'fixed';
            summaryDiv.style.top = '50%'; /* Center vertically as well */
            summaryDiv.style.left = '50%';
            summaryDiv.style.transform = 'translate(-50%, 0)'; /* Center both horizontally and vertically */
            summaryDiv.style.maxWidth = 'fit-content';
            summaryDiv.style.padding = '10px';
            

            const chart = LightweightCharts.createChart(document.getElementById('chart'), {
                width: 600,
                height: 400,
            });

            const lineSeries = chart.addLineSeries();
            lineSeries.setData(solPairData);
        });
    });
});

</script>
<style>
    .card-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        margin: 0 auto;
        padding: 0 10px;
        width: 100%;
        box-sizing: border-box;
    }
    .card {
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 10px;
        margin: 20px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        background-color: #f9f9f9;
        width: 425px;
        display: flex;
        float: left;
        position: relative;
        cursor: pointer;
    }
    .card-title {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 10px;
        align-self: flex-end;
        position: absolute;
        top: 10px;
        right: 10px;
    }
    .card-content .label {
        font-weight: bold;
        display: inline-block;
        width: 150px;
    }
    .card-content .value {
        display: inline-block;
    }
    .summary-table table {
        width: 100%;
        border-collapse: collapse;
    }
    .summary-table th, .summary-table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
    }
    .summary-table th {
        background-color: #f2f2f2;
    }

    #summary-div {
        display: none;
        position: absolute;
        top: 0;
        left: 0;
        width: 75%;
        height: 200px;
        background-color: white;
        border: 1px solid #ccc;
        padding: 20px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        z-index: 1000;
    }
</style>
{% endblock %}