{% extends "base.html" %}

{% block title %}Home - Dexscreener{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Summary Div -->
    <div class="d-none d-md-block" id="summary-div">
        <!-- Summary content will be dynamically inserted here -->
    </div>
    <div class="row">
        {% for data in pool_data %}
          <div class="col-md-4 mb-4">
            <div class="card" data-token-pair="{{ data['pool_id'] }}">
              <div class="card-body">
                <h5 class="card-title">{{ data['pool_id'] }}</h5>
                <!-- <p><strong>Pool ID:</strong> {{ data['pool_id'] }}</p> -->
                <p><strong>TVL</strong> {{ data['tvl'] }}</p>  
                <p><strong>Price (USD):</strong> {{ data['price'] }}</p>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const cards = document.querySelectorAll('.card');
    const summaryDiv = document.getElementById('summary-div');   

    cards.forEach(card => {
        card.addEventListener('click', () => {
            const tokenPairAddress = card.getAttribute('data-token-pair');
            console.log(tokenPairAddress);

            sendTokenPairAddressToFlask(tokenPairAddress);

            summaryDiv.style.display = 'block';
            summaryDiv.innerHTML = `
                <div> 
                    <img src="transaction_chart.png?t=${new Date().getTime()}" alt="Transaction Chart">
                </div>
            `;
        });
    });

    function sendTokenPairAddressToFlask(tokenPairAddress) {
        fetch('/process-data', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ tokenPairAddress: tokenPairAddress }),
        })
        .then(response => response.json())
        .then(data => {
            console.log('Success:', data.pair_URL);
            const pair_URL = data.pair_URL;
            const chain_id = data.chain_id;
            const dex_id = data.dex_id;
            const quote_token = data.quote_token;
            const base_token = data.base_token;
            const liquidity_usd = data.liquidity_usd
            const price_usd = data.price_usd
            const volume_24h = data.volume_24h
            const price_native = data.price_native
            
            summaryDiv.innerHTML = `
            <div class="row">
                <div> 
                    <p> ${quote_token} / ${base_token} </p> 
                    <p> Chain: ${chain_id} </p> 
                    <p> Liquidity (USD): ${liquidity_usd} </p>
                    <p> Dex: ${dex_id} </p>
                    <p> Base Token: ${base_token} </p>
                    <p> Native Price: ${price_native} </p>
                    <p> Quote Token: ${quote_token} </p>
                    <p> Price USD: ${price_usd} </p>
                    <p> Volume 24H: ${volume_24h} </p>                   
                    <p> URL: <a href="${pair_URL}">${pair_URL}</a> </p>
                    <img src="transaction_chart.png?t=${new Date().getTime()}" alt="Transaction Chart">
                </div>
            </div>
            `;
        })
        .catch((error) => {
            console.error('Error:', error);
        });
    }
});

</script>
{% endblock %}
